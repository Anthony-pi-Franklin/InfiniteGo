# InfiniteGo - 多房间功能使用说明

## 改进功能

### 1. 多房间支持
- ✅ 新增 RoomManager 管理多个游戏房间
- ✅ 支持通过 `/ws?room=ID` 连接到指定房间
- ✅ 前端增加房间选择/创建页面（lobby.html）
- ✅ 不再直接进入游戏，需要先选择或创建房间

### 2. 颜色管理
- ✅ 后端已放开黑白颜色限制，支持 10 种颜色（0-9）
- ✅ 每个玩家只能选择一种颜色，进入房间后不能更改
- ✅ 前端增加颜色选择界面，在大厅中选择颜色后加入房间
- ✅ 游戏中只能放置自己选择的颜色的棋子

### 3. 局域网/全网兼容
- ✅ 测试环境支持局域网联机
- ✅ 保留全网联机兼容性
- ✅ WebSocket 连接自动适配 ws/wss 协议

## 使用方法

### 启动服务器
```bash
cd rt-sand-mvp/server
go run cmd/main.go
```

服务器将在 `http://localhost:8080` 启动

### 访问游戏

1. **打开大厅页面**
   - 访问：`http://localhost:8080/lobby.html`
   - 或者直接访问 `http://localhost:8080` 会自动重定向到大厅

2. **创建新房间**
   - 在"创建新房间"区域输入房间名称（可留空自动生成）
   - 选择你的颜色（0-9，对应黑/白/红/蓝/绿/黄/紫/橙/青/粉）
   - 点击"创建并加入房间"

3. **加入现有房间**
   - 查看房间列表，选择一个房间点击"加入房间"
   - 或在"快速加入"区域输入房间名称直接加入

4. **游戏中**
   - 右上角显示当前房间名称和你的颜色
   - 只能放置自己选择颜色的棋子
   - 点击"返回大厅"可以离开房间

### 局域网联机

同一局域网的其他设备可以通过以下方式加入：

```
http://<服务器IP>:8080/lobby.html
```

例如：`http://192.168.1.100:8080/lobby.html`

### API 端点

- `GET /api/rooms` - 获取所有活跃房间列表
- `GET /ws?room=<房间ID>` - WebSocket 连接到指定房间

## 技术实现

### 后端改进
- **roommanager.go**: 房间管理器，支持创建/获取/列出房间
- **ws.go**: 支持 URL 参数获取房间 ID，颜色选择和验证
- **main.go**: 集成 RoomManager，添加 API 端点

### 前端改进
- **lobby.html/js/css**: 新的房间选择界面
- **net.js**: 支持带房间参数的 WebSocket 连接
- **main.js**: 从 URL/session 获取房间信息
- **index.html**: 增加房间信息显示和返回大厅按钮

## 颜色映射

| 编号 | 颜色 | 代码 |
|------|------|------|
| 0 | 黑色 | #000000 |
| 1 | 白色 | #FFFFFF |
| 2 | 红色 | #e74c3c |
| 3 | 蓝色 | #3498db |
| 4 | 绿色 | #2ecc71 |
| 5 | 黄色 | #f39c12 |
| 6 | 紫色 | #9b59b6 |
| 7 | 橙色 | #e67e22 |
| 8 | 青色 | #1abc9c |
| 9 | 粉色 | #e91e63 |

## 注意事项

1. 房间名称规则：只能包含字母、数字、下划线和连字符，长度 1-50 字符
2. 玩家进入房间后颜色锁定，如需更改颜色需返回大厅重新加入
3. 房间会在没有玩家时保持活跃，需要手动清理或重启服务器
4. 支持无限数量的玩家在同一房间内游戏
5. 每个玩家的操作只影响自己选择的颜色的棋子

## 测试建议

1. **单机测试**：在浏览器中打开多个标签页，分别加入不同房间
2. **局域网测试**：使用同一网络的多个设备访问服务器IP
3. **颜色测试**：选择不同颜色，确认只能放置选定颜色的棋子
4. **房间隔离测试**：在不同房间下棋，确认互不影响

## 故障排除

**问题**：无法连接到服务器
- 检查服务器是否正在运行
- 确认端口 8080 未被占用
- 局域网访问时检查防火墙设置

**问题**：房间列表不显示
- 检查浏览器控制台是否有错误
- 确认 `/api/rooms` 端点正常响应
- 刷新页面或点击"刷新房间列表"

**问题**：无法放置棋子
- 确认已选择颜色
- 检查是否尝试放置非自己颜色的棋子
- 查看状态栏的错误信息
